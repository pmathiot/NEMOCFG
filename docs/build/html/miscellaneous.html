

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NetCDF &mdash; NEMO@IGE  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="HPC centres" href="HPC_centres.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> NEMO@IGE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Input files</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="input_DATA.html">Original data set</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_eORCA12.html">eORCA12 input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_eORCA025.html">eORCA025 input files</a></li>
</ul>
<p class="caption"><span class="caption-text">Mask files</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mask_eORCA025.html">eORCA025 mask files</a></li>
</ul>
<p class="caption"><span class="caption-text">NEMO simulations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simu_eORCA025.html">eORCA025 simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="simu_AMUXL025.html">AMUXL025 simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="simu_AMUXL12.html">AMUXL12 simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="simu_AMUXL36.html">AMUXL36 simulations</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools_nemo.html">NEMO tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools_nemo.html#drakkar-tools">DRAKKAR tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools_nemo.html#others-tools">OTHERS tools</a></li>
</ul>
<p class="caption"><span class="caption-text">HPC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HPC_centres.html">HPC centres</a></li>
<li class="toctree-l1"><a class="reference internal" href="HPC_centres.html#parallelisation">Parallelisation</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellaneous</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">NetCDF</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#chunking">Chunking</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deflation">Deflation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nco">nco</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ncks">ncks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#restructuredtext">reStructuredText</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creation-of-the-html-from-rst-file">Creation of the html from rst file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#syntax-of-rst-file">Syntax of rst file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#cmip6-data">CMIP6 data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#wget">Wget</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NEMO@IGE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>NetCDF</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/miscellaneous.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="netcdf">
<h1>NetCDF<a class="headerlink" href="#netcdf" title="Permalink to this headline">¶</a></h1>
<div class="section" id="chunking">
<h2>Chunking<a class="headerlink" href="#chunking" title="Permalink to this headline">¶</a></h2>
<p>The definition of chunking is well described here: <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/workshops/most-recent/nc4chunking/WhatIsChunking.html">https://www.unidata.ucar.edu/software/netcdf/workshops/most-recent/nc4chunking/WhatIsChunking.html</a>.</p>
<ul class="simple">
<li><p>how to know the chunk size of a file (ncdump -hs):</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ncdump -hs toce_nico.nc</span>

<span class="go">netcdf toce_nico {</span>
<span class="go">dimensions:</span>
<span class="go">      deptht = 75 ;</span>
<span class="go">      axis_nbounds = 2 ;</span>
<span class="go">      y = 567 ;</span>
<span class="go">      x = 687 ;</span>
<span class="go">      time_counter = UNLIMITED ; // (32 currently)</span>
<span class="go">variables:</span>
<span class="go">...</span>
<span class="go">      float toce(time_counter, deptht, y, x) ;</span>
<span class="go">              toce:standard_name = &quot;sea_water_potential_temperature&quot; ;</span>
<span class="go">    ...</span>
<span class="go">              toce:_Storage = &quot;chunked&quot; ;</span>
<span class="go">              toce:_ChunkSizes = 1, 19, 142, 172 ;</span>
<span class="go">              toce:_Endianness = &quot;little&quot; ;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In the previous file, it means to access toce, netcdf will read tile of (1, 19, 142, 172).
So, if you read with an horizontal 2d access (a map), you will read more data than needed because netcdf will first read 19 levels then filter out the map you want.
For a ‘map’ access, the best is to have a chunksize of 1 on the vertical. I don’t know for AMUXL, but for eORCA12 access of 3d variable this is CRITICAL to have the right chunking size.
If you plan to extract only vertical profile from your output file, the chunck will probably be something like (1, nz, cx, cy) cx and cy to be defined by testing.</p></li>
<li><p>how to specify a specific chunking: to do so, you can either:
- copy you file with nccopy and specifying a new chunksize with the -c option.
- extract and copy with ncks and  –cnk_dmn option</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nccopy -c x/200,y/200,deptht/1,time_counter/1 toce_nico.nc out.nc</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ncks --cnk_dmn x,200 --cnk_dmn y,200 --cnk_dmn time_counter,1 --cnk_dmn deptht,1 -d deptht,0,0 -v toce toce_nico.nc out.nc</span>
</pre></div>
</div>
<ul class="simple">
<li><p>If you found on of your processing is very very slow, have a look to your chunksize and see if it is adapted to your reading pattern.</p></li>
</ul>
</div>
<div class="section" id="deflation">
<h2>Deflation<a class="headerlink" href="#deflation" title="Permalink to this headline">¶</a></h2>
<p>Netcdf since the version 4 support deflation (ie compression),
depending on your netcdf it can save a lot of storage (the more 0 you have, the more efficient it is).</p>
<p>Below some test made with AMUXL12 configuration with a file containing a month of daily 3d temperature.</p>
<ul class="simple">
<li><p>as expected, the higher is the compression level, the longer it takes to create it (-d option of nccopy or -L option with ncks).</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">time nccopy -d 0 -c x/200,y/200,deptht/1,time_counter/1 toce_nico.nc toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d0</span>

<span class="go">real  0m23.817s</span>
<span class="go">user  0m2.731s</span>
<span class="go">sys   0m7.741s</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">time nccopy -d 1 -c x/200,y/200,deptht/1,time_counter/1 toce_nico.nc toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d1</span>

<span class="go">real  1m37.195s</span>
<span class="go">user  1m32.293s</span>
<span class="go">sys   0m4.242s</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">time nccopy -d 2 -c x/200,y/200,deptht/1,time_counter/1 toce_nico.nc toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d2</span>

<span class="go">real  1m38.894s</span>
<span class="go">user  1m34.070s</span>
<span class="go">sys   0m4.317s</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">time nccopy -d 9 -c x/200,y/200,deptht/1,time_counter/1 toce_nico.nc toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d9</span>

<span class="go">real  2m27.320s</span>
<span class="go">user  2m19.162s</span>
<span class="go">sys   0m4.354s</span>
</pre></div>
</div>
<ul class="simple">
<li><p>as expected, the higher the compression level is, the smaller the final file is. However for AMUXL,
the differences are tiny between d1 and d9 and you will spend more time to create it and read it (2.096 Gb for d1 and 2.068 Gb for d9).
d1 is thus a good compromise. You spare 1.7 Gb (ie 44 %) of storage while minimizing the draw back of a slower writing/reading
(probably this depends of the computer as you trade reading by cpu for decompression)</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">3804842884 Jan 20 10:23 toce_nico.nc</span>
<span class="go">2096447815 Jan 20 10:25 toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d1</span>
<span class="go">2094722329 Jan 20 10:38 toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d2</span>
<span class="go">2068371276 Jan 20 10:33 toce_nico.nc_4.4.4-intel-19.0.4-intelmpi-2019.4.243_d9</span>
</pre></div>
</div>
</div>
<div class="section" id="nco">
<h2>nco<a class="headerlink" href="#nco" title="Permalink to this headline">¶</a></h2>
<p>NCO is netcdf tools box to manipulate netcdf. It is very useful to extract date, concatenate file, make some operation, average files …</p>
<div class="section" id="ncks">
<h3>ncks<a class="headerlink" href="#ncks" title="Permalink to this headline">¶</a></h3>
<p>ncks is a tools to extract data out of a netcdf file. I allow to extract/exclude variable or cut file along dimension.</p>
<p>For exemple, the following command will extract only the first deptht level (-d option) from toce variable (-v option) in out.nc.
out.nc will be written with a deflation level of 1 (-L option) and a chunksize of (x/200, y/200, deptht/1, time_counter/1).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ncks -L 1 --cnk_dmn x,200 --cnk_dmn y,200 --cnk_dmn time_counter,1 --cnk_dmn deptht,1 -d deptht,0,0 -v toce toce_nico.nc out.nc</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="restructuredtext">
<h1>reStructuredText<a class="headerlink" href="#restructuredtext" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creation-of-the-html-from-rst-file">
<h2>Creation of the html from rst file<a class="headerlink" href="#creation-of-the-html-from-rst-file" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>1: installation of sphinx:</dt><dd><p>conda is your best friends:</p>
</dd>
</dl>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> conda install sphinx
</pre></div>
</div>
<dl class="simple">
<dt>2: run a quick installation:</dt><dd><p>The fastest way to do it is to use sphinx-quickstart</p>
</dd>
</dl>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sphinx-quickstart

<span class="go">your output should be like this:</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Welcome to the Sphinx 3.2.1 quickstart utility.</span>

<span class="go">Please enter values for the following settings (just press Enter to</span>
<span class="go">accept a default value, if one is given in brackets).</span>

<span class="go">Selected root path: .</span>

<span class="go">You have two options for placing the build directory for Sphinx output.</span>
<span class="go">Either, you use a directory &quot;_build&quot; within the root path, or you separate</span>
<span class="go">&quot;source&quot; and &quot;build&quot; directories within the root path.</span>
<span class="gp">&gt;</span> Separate <span class="nb">source</span> and build directories <span class="o">(</span>y/n<span class="o">)</span> <span class="o">[</span>n<span class="o">]</span>: y

<span class="go">The project name will occur in several places in the built documentation.</span>
<span class="gp">&gt;</span> Project name: <span class="nb">test</span>
<span class="gp">&gt;</span> Author name<span class="o">(</span>s<span class="o">)</span>: toto
<span class="gp">&gt;</span> Project release <span class="o">[]</span>: <span class="m">0</span>.0

<span class="go">If the documents are to be written in a language other than English,</span>
<span class="go">you can select a language here by its language code. Sphinx will then</span>
<span class="go">translate text that it generates into that language.</span>

<span class="go">For a list of supported codes, see</span>
<span class="gp">https://www.sphinx-doc.org/en/master/usage/configuration.html#</span>confval-language.
<span class="gp">&gt;</span> Project language <span class="o">[</span>en<span class="o">]</span>:

<span class="go">Creating file /Users/mathiotp/Test/source/conf.py.</span>
<span class="go">Creating file /Users/mathiotp/Test/source/index.rst.</span>
<span class="go">Creating file /Users/mathiotp/Test/Makefile.</span>
<span class="go">Creating file /Users/mathiotp/Test/make.bat.</span>

<span class="go">Finished: An initial directory structure has been created.</span>

<span class="go">You should now populate your master file /Users/mathiotp/Test/source/index.rst and create other documentation</span>
<span class="go">source files. Use the Makefile to build the docs, like so:</span>
<span class="go">   make builder</span>
<span class="go">where &quot;builder&quot; is one of the supported builders, e.g. html, latex or linkcheck.</span>
</pre></div>
</div>
<dl class="simple">
<dt>3: build the web site</dt><dd><p>the command make html will do the job for you.</p>
</dd>
</dl>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> make html

<span class="go">Running Sphinx v3.2.1</span>
<span class="go">making output directory... done</span>
<span class="go">building [mo]: targets for 0 po files that are out of date</span>
<span class="go">building [html]: targets for 1 source files that are out of date</span>
<span class="go">updating environment: [new config] 1 added, 0 changed, 0 removed</span>
<span class="go">reading sources... [100%] index</span>
<span class="go">looking for now-outdated files... none found</span>
<span class="go">pickling environment... done</span>
<span class="go">checking consistency... done</span>
<span class="go">preparing documents... done</span>
<span class="go">writing output... [100%] index</span>
<span class="go">generating indices...  genindexdone</span>
<span class="go">writing additional pages...  searchdone</span>
<span class="go">copying static files... ... done</span>
<span class="go">copying extra files... done</span>
<span class="go">dumping search index in English (code: en)... done</span>
<span class="go">dumping object inventory... done</span>
<span class="go">build succeeded.</span>
</pre></div>
</div>
<dl class="simple">
<dt>4: visualise your html</dt><dd><p>a index.html is available in build/html and you can visualise it with your favorite browser</p>
</dd>
<dt>5: customize it</dt><dd><p>the graphical option are controle by the conf.py file in source.
For something similar to this, refer to the conf.py in the source directory of the ghpages branch project.</p>
</dd>
<dt>6: publish it on github pages.</dt><dd><p>This is probably the most tricky part.</p>
</dd>
</dl>
<ul class="simple">
<li><p>setp 1: you need to have an account on git, create your project and push all the files (make, build, source …). If you are not premium, you need to have your repo public.</p></li>
<li><p>step 2: create a branch call it gh-pages</p></li>
<li><p>step 3: check in your repository setting that gh-pages is activated</p></li>
<li><p>step 4: add an empty file .nojekyll in your directory to tell github to not interpret it as md.</p></li>
<li><p>step 5: if not done, you need to add in your conf.py these lines (it works for me):</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">import sphinx_rtd_theme</span>

<span class="go">html_theme = &#39;sphinx_rtd_theme&#39;</span>
</pre></div>
</div>
<p>and add sphinx_rtd_theme to the extension:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">extensions = [...,&#39;sphinx_rtd_theme&#39;]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>step 6: commit and push the changes to gh-pages branch (you can check in your github interface if the web site is well published).
The site will be in ‘<a class="reference external" href="https://username.github.io/REPO/docs/build/html/index.html">https://username.github.io/REPO/docs/build/html/index.html</a>’. For a quick access, you can add the link to your README.</p></li>
</ul>
</div>
<div class="section" id="syntax-of-rst-file">
<h2>Syntax of rst file<a class="headerlink" href="#syntax-of-rst-file" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>a quick and detailed guide is available here: <a class="reference external" href="https://docutils.sourceforge.io/docs/user/rst/quickref.html">https://docutils.sourceforge.io/docs/user/rst/quickref.html</a></p></li>
<li><p>All this site is written in rst, so for any option you see in these pages, you can refer to the source code.</p></li>
</ul>
</div>
</div>
<div class="section" id="cmip6-data">
<h1>CMIP6 data<a class="headerlink" href="#cmip6-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="wget">
<h2>Wget<a class="headerlink" href="#wget" title="Permalink to this headline">¶</a></h2>
<p>You can find all the available name, variable … here: <a class="reference external" href="https://esgf-index1.ceda.ac.uk/search/cmip6-ceda/">https://esgf-index1.ceda.ac.uk/search/cmip6-ceda/</a>
A listing of all the facet available for the query is described here: <a class="reference external" href="https://esgf-node.llnl.gov/esg-search/search?project=CMIP6&amp;facets=*&amp;limit=0">https://esgf-node.llnl.gov/esg-search/search?project=CMIP6&amp;facets=*&amp;limit=0</a></p>
<p>To create the wget script:
1. look for your data</p>
<blockquote>
<div><p>To do this you have to enter this http: <a class="reference external" href="https://esgf-node.llnl.gov/esg-search/search?experiment_id=ssp585&amp;variable=tob&amp;distrib=true">https://esgf-node.llnl.gov/esg-search/search?experiment_id=ssp585&amp;variable=tob&amp;distrib=true</a>.
In this case, I am looking for the variable tob in the ssp585 experiment id on all the server. More details on the method here:
<a class="reference external" href="https://esgf.github.io/esgf-user-support/user_guide.html#facet-queries">https://esgf.github.io/esgf-user-support/user_guide.html#facet-queries</a>.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>get your wget script</p></li>
</ol>
<blockquote>
<div><p>Replace in the http, ‘search?’ by ‘wget?’</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>run the script with the -s option</p></li>
</ol>
<p>For more advanced method, look at the documentation.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="HPC_centres.html" class="btn btn-neutral float-left" title="HPC centres" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, DRAKKAR

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>